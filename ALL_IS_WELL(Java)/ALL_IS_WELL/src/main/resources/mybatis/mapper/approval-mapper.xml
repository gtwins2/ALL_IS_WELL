<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="approval">
	
	<select id="getApprovalListCnt" resultType="int">
		SELECT COUNT(*)
		FROM APPROVAL_DOCUMENT
		WHERE MEMBER_NO = #{no}
	</select>
	
	<select id="getApprovalList" resultType="com.kh.app.approval.vo.ApprovalVo">
	    SELECT
	        AD.NO,
	        AD.MEMBER_NO,
	        AD.CREATE_DATE,
	        AD.TITLE,
	        M.NAME AS MEMBER_NAME,
	        AD.STATUS
	    FROM APPROVAL_DOCUMENT AD
	    JOIN MEMBER M ON M.NO = AD.MEMBER_NO
	    JOIN APPROVER A ON M.NO = A.APPROVER_NO
	    WHERE MEMBER_NO = #{no}
	    ORDER BY AD.NO DESC
	</select>
	
	<!-- 휴가 문서 생성 -->
<!-- 	<insert id="vacationBtn">
		INSERT INTO 
		APPROVAL_DOCUMENT
		(NO, MEMBER_NO, CREATE_DATE, TITLE)
		VALUES
		(SEQ_APPROVAL_DOCUMENT_NO.NEXTVAL, #{memberNo}, SYSDATE, '휴가문서')
	</insert>
	
	<select id="vacationAfterInsert" resultType="com.kh.app.approval.vo.ApprovalBtnVo">
		SELECT 
			AD.NO,
			AD.MEMBER_NO,
			AD.CREATE_DATE,
			AD.TITLE,
			D.NAME AS DEPARTMENT_NAME
		FROM APPROVAL_DOCUMENT AD
		JOIN MEMBER M ON M.NO = AD.MEMBER_NO
		JOIN DEPARTMENT D ON D.NO = M.DEPARTMENT_NO
		WHERE AD.NO = (SELECT MAX(NO) FROM APPROVAL_DOCUMENT WHERE MEMBER_NO = #{memberNo})
	</select>
	
	<insert id="writeVacation">
		INSERT INTO
		VACATION_APPROVAL_DOCUMENT
		(
			NO,
			APPROVAL_DOCUMENT_NO,
			NO2,
			CONTENT,
			USE_DATE,
			START_DATE,
			END_DATE
		)
		VALUES
		(
			SEQ_VACATION_APPROVAL_DOCUMENT_NO.NEXTVAL,
			#{approvalDocumentNo},
			#{no2},
			#{content},
			#{useDate},
			#{startDate},
			#{endDate}
		)
	</insert> -->
	
	
	<!-- 출장 문서 생성 -->
	<insert id="tripBtn">
		INSERT INTO 
		APPROVAL_DOCUMENT
		(NO, MEMBER_NO, CREATE_DATE, TITLE)
		VALUES
		(SEQ_APPROVAL_DOCUMENT_NO.NEXTVAL, #{memberNo}, SYSDATE, '출장문서')
	</insert>
	
	<insert id="writeTrip">
		INSERT INTO
		BUSINESS_TRIP_APPROVAL_DOCUMENT
		(
			NO, 
			APPROVAL_DOCUMENT_NO,
			CONTENT,
			START_DATE,
			END_DATE
		)
		VALUES
		(
			SEQ_BUSINESS_TRIP_APPROVAL_DOCUMENT_NO.NEXTVAL,
			#{approvalDocumentNo},
			#{content},
			#{startDate},
			#{endDate}
		)
	</insert>
	
	<select id="detailTrip" resultType="com.kh.app.approval.vo.BusinessTripApprovalVo">
		SELECT 
			AD.NO,
			AD.MEMBER_NO,
			AD.CREATE_DATE,
			BTAD.CONTENT,
			BTAD.START_DATE,
			BTAD.END_DATE
		FROM APPROVAL_DOCUMENT AD
		JOIN BUSINESS_TRIP_APPROVAL_DOCUMENT BTAD ON AD.NO = BTAD.APPROVAL_DOCUMENT_NO
		WHERE AD.NO = #{bno}
	</select>
	
</mapper>